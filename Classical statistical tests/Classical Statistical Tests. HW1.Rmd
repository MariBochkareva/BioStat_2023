---
title: "Task 5"
author: "Oleg Arnaut"
date: "2023-11-26"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)

```

# Инструкции

Ниже приведены семь клинических гипотез. В качестве задания протестируйте их, используя соответствующие статистические критерии. Решение должно содержать все элементы алгоритма проверки статистических гипотез:

* Сформулируете нулевую и альтернативную гипотезы.
* Укажите уровень значимости α.
* Определите статистический тест (критерий) для проверки гипотезы. При необходимости аргументируйте выбор одностороннего теста. 
* Укажите критическое значение статистики (используйте распределения из материалов лекции).
* Определите наблюдаемое значение статистики.
* Оцените статистическую значимость (p-value и/или доверительный интервал).
* Оцените практическую значимость.

Данные для анализа необходимо генерировать самостоятельно в соответствии с каждой представленной гипотезой. По возможности используйте пакет dplyr


# Гипотеза 1. 
Существует ассоциация между уровнем физической активности (бинарная переменная, физическая активность может быть 'высокой' и 'низкой') и частотой возникновения сердечно-сосудистых заболеваний у пациентов старше 50 лет. Попробуйте вариант с большими выборками (sample_size <- 100). Как изменится стратегия при малых выборках (sample_size <- 30) ? 

## Генерация данных

```{r}

# Воспроизводимость результатов
set.seed(42)

# Общий размер выборки 
sample_size <- 100

# Генерация данных по физической активности (бинарная переменная) в фиксированном соотношении 1:1
activity <- sample(c("высокая", "низкая"), sample_size, replace = TRUE)

# Генерация данных по наличию сердечно-сосудистых заболеваний (бинарная переменная)
# У активных людей меньше вероятность заболеть (0.5 vs 0.6)

cardio <- sapply(activity, function(x) {
  if (x == "высокая") {
    sample(c(1, 0), 1, prob = c(0.5, 0.5)) # 1 - наличие заболевания, 0 - отсутствие заболевания
  } else {
    sample(c(1, 0), 1, prob = c(0.6, 0.4))
  }
})

# Создание dataframe
data_task1 <- data.frame(activity, cardio)

```

## Решение

Ho: ассоциации между уровнем физической активности и частотой возникновения сердечно-сосудистых заболеваний у пациентов старше 50 лет нет.

H1: существует ассоциация между уровнем физической активности и частотой возникновения сердечно-сосудистых заболеваний у пациентов старше 50 лет.

```{r}

α = 0.05

```
*Cтатистический тест (критерий) для проверки гипотезы:*

Применим двусторонний тест хи-квадрат, т.к: 
 * обе переменные категориальные;
 * цель исследования - определить, существует ли статистически значимая ассоциация между двумя переменными.

*Укажите критическое значение статистики (используйте распределения из материалов лекции)*

Для определения критического значения статистики теста хи-квадрат, необходимо знать два параметра:

* уровень значимости (α = 0.05)
* степени свободы (df=(r−1)×(c−1) = 1)

```{r}

quantiles <- c(0.025, 0.975)# Квантили
df <- 1

# Расчет критических значений для распределения хи-квадрат
critical_value_lower <- qchisq(quantiles[1], df)
critical_value_upper <- qchisq(quantiles[2], df)
```
*Определите наблюдаемое значение статистики:*

```{r}

# Создание таблицы сопряженности
contingency_table <- table(data_task1$activity, data_task1$cardio)

# Проведение теста хи-квадрат
chi_squared_test <- chisq.test(contingency_table)

# Наблюдаемое значение статистики хи-квадрат
observed_chi_squared <- chi_squared_test$statistic

# Вывод наблюдаемого значения статистики
print(observed_chi_squared)

```

*Оцените статистическую значимость (p-value и/или доверительный интервал)*

```{r}

# P-value теста хи-квадрат
p_value <- chi_squared_test$p.value

# Вывод p-value
print(paste("P-value:", p_value))
```

Визуализация Probability Density Function (PDF) распределения хи-квадрат
```{r}

# Определение диапазона значений x для распределения хи-квадрат
x_values <- seq(0, 10, length.out = 100)

# Вычисление значений PDF для распределения хи-квадрат
pdf_chi_squared <- dchisq(x_values, df)

# Создание data frame для построения графика
pdf_data <- data.frame(x = x_values, Probability = pdf_chi_squared)

# Создание графика PDF для визуализации распределения хи-квадрат
ggplot(pdf_data, aes(x = x, y = Probability)) +
  geom_line(size = 1, color = "black") +
  labs(title = "PDF распределения хи-квадрат", x = "x", y = "Плотность вероятности") +
  theme_minimal() +
  geom_vline(xintercept = c(critical_value_lower, critical_value_upper, observed_chi_squared),
             linetype = c("solid", "solid", "dashed"),
             color = c("blue", "blue", "red"),
             size = c(2, 2, 2)) +
  annotate("text", x = critical_value_lower - 0.5, y = 0.9, label = sprintf("Q(%.3f)=%.2f", quantiles[1], critical_value_lower), hjust = 1, angle = 90) +
  annotate("text", x = critical_value_upper - 0.5, y = 0.9, label = sprintf("Q(%.3f)=%.2f", quantiles[2], critical_value_upper), hjust = 1, angle = 90) +
  annotate("text", x = observed_chi_squared + 0.3, y = 0.9, label = 'наблюдаемое', hjust = 1, angle = 90) +
  annotate("text", x = critical_value_upper + 5, y = 0.9, label = sprintf("df = %.0f", df), hjust = 1)

```
P-value: 0.669254335146295 и X-squared 0.1824756 - не позволяют отвергунть нулевую гипотезу.

*Обсуждение стратегии при малых выборках (sample_size <- 30):*

!При set.seed(42) и sample_size <- 30 P-value: 0.819476976777521 все еще не позволяет отвергнуть нулевую гипотезу, но надежность таких статистических выводов снижается.

При малых выборках предпочтительнее использовать точный тест Фишера, так как стандартный тест хи-квадрат может быть ненадежным при малых ожидаемых частотах в таблице сопряженности (частоты в ячейках таблицы сопряженности предпочтительно должны быть более 5 для применения хи-квадат).


# Гипотеза 2.
Применение нового метода лечения для пациентов с артериальной гипертензией приведет к уменьшению среднего артериального давления по сравнению с пациентами, получающими стандартное лечение.

## Генерация данных 

```{r}

# Воспроизводимость результатов
set.seed(42)

# Размер выборки (в каждой группе)
sample_size <- 80

# В популяции c экспериментальным методом лечения средний уровень систолического артериального давления меньше (130 vs 135 mm) 
# Генерация данных для группы с новым методом лечения 
group1 <- rnorm(sample_size, mean=130, sd=10)  # экспериментальная группа

# Генерация данных для группы со стандартным лечением
group2 <- rnorm(sample_size, mean=135, sd=10)  # контрольная группа

```

## Решение

*Сформулируйте нулевую и альтернативную гипотезы:* 

Ho: применение нового метода лечения не влияет на среднее артериальное давление, или его влияние не отличается от стандартного лечения.

H1:применение нового метода лечения для пациентов с артериальной гипертензией приведет к уменьшению среднего артериального давления по сравнению с пациентами, получающими стандартное лечение.

*Укажите уровень значимости α: 0.05*

*Определите статистический тест (критерий) для проверки гипотезы. При необходимости аргументируйте выбор одностороннего теста.*
 
Односторонний t-тест для независимых выборок, т.к.:

1. Тип данных  - количественный
2. Цель исследования - сравнение средних значений двух групп
3. Независимые выборки
4. Предполагается нормальное распределение данных внутри групп и примерное равенство дисперсий
5. Направленность гипотезы:
Альтернативная гипотеза предполагает уменьшение среднего артериального давления благодаря новому методу лечения, что обосновывает использование одностороннего t-теста. Если бы гипотеза предполагала только различие (без указания направления), то следовало бы использовать двусторонний тест. В данном случае в гипотезе #2 сформулирована задача "superiority". 

*Укажите критическое значение статистики:*

```{r}
# Параметры выборок
n1 <- 80  # Размер первой выборки
n2 <- 80  # Размер второй выборки
sd1 <- 10 # Стандартное отклонение в первой группе
sd2 <- 10 # Стандартное отклонение во второй группе

# Расчет степеней свободы для Welch t-test
df_welch <- ((sd1^2/n1 + sd2^2/n2)^2) /
            ((sd1^2/n1)^2/(n1-1) + (sd2^2/n2)^2/(n2-1))

# Уровень значимости
alpha <- 0.05

# Критическое значение для одностороннего t-теста с уровнем значимости 0.05
critical_value_welch <- qt(1 - alpha, df_welch, lower.tail = FALSE)

df_welch
critical_value_welch

```

 
*Определите наблюдаемое значение статистики.*

```{r}
# Выполнение t-теста
t_test_result <- t.test(group1, group2, alternative = "less")

# Вывод результатов t-теста
t_test_result

# Оценка размера эффекта (разница средних)
effect_size <- mean(group1) - mean(group2)
effect_size
```




*Оцените статистическую значимость (p-value и/или доверительный интервал).*

Статистическая значимость: p-значение (p-value = 0.009466) меньше установленного уровня значимости α = 0.05), что указывает на статистически значимое различие между группами. Это означает, что мы можем отклонить нулевую гипотезу о том, что новый метод лечения не влияет на среднее артериальное давление или его влияние равно влиянию стандартного лечения.

Направление эффекта: Отрицательное значение t-значения и интервал, не включающий 0 в свой верхний предел, указывают на то, что новый метод лечения, вероятно, уменьшает среднее артериальное давление по сравнению со стандартным лечением.

Размер эффекта: Разница в средних между группами составляет приблизительно -3.75 мм рт. ст., что может быть интерпретировано как клинически значимое улучшение, в зависимости от контекста исследования.

*Оцените практическую значимость.*
Практическая значимость: разница в 3.75 мм рт. ст. может быть существенной в контексте лечения артериальной гипертензии, но окончательное решение зависит от клинической практики в данной области. 


# Гипотеза 3. 
Внедрение программы реабилитации для пациентов с хронической болью в спине приведет к улучшению их физической активности (предположим что физическую активность можно оценить по шкале 0-100)

## Генерация данных 
*в шаблоне кода была указана функция для генерации rbinom, но исходя из описанной гипотезы, распределение должно быть не биномиальным.

```{r}

# Воспроизводимость результатов
set.seed(42)

# Размер выборки 
sample_size <- 30

# В популяции до реабилитации средний уровень физической активности (50)
# Стандартное отклонение предположим равным 10
before <- rnorm(sample_size, mean = 50, sd = 10)

# В популяции после реабилитации средний уровень физической активности выше (60)
# Стандартное отклонение предположим равным 10
after <- rnorm(sample_size, mean = 60, sd = 10)

# Обрезаем значения, чтобы они находились в пределах от 0 до 100
before <- pmin(pmax(before, 0), 100)
after <- pmin(pmax(after, 0), 100)

```
## Решение

*Сформулируете нулевую и альтернативную гипотезы*

H0: Внедрение программы реабилитации не приведет к статистически значимому изменению в уровне физической активности пациентов с хронической болью в спине.

H1: Внедрение программы реабилитации приведет к статистически значимому улучшению физической активности пациентов с хронической болью в спине.
 
*Укажите уровень значимости:*
α= 0.05

*Определите статистический тест (критерий) для проверки гипотезы. При необходимости аргументируйте выбор одностороннего теста.*

Односторонний парный t-тест, т.к.:

* Цель исследования: сравнение средних значений уровня активности до и после программы реабилитации
* Измерение до и после реабилитации -> связанные выборки
* Переменная непрерывная (физическая активность)
* Альтернативная гипотеза специфически предполагает улучшение, а не любое изменение.


*Укажите критическое значение статистики*

```{r}

# Уровень значимости
alpha <- 0.05

# Число степеней свободы
df <- sample_size - 1

# Критическое значение для одностороннего t-теста
critical_value <- qt(1 - alpha, df, lower.tail = FALSE)

print(paste("Критическое значение для правостороннего t-теста:", critical_value))

```


*Определите наблюдаемое значение статистики*

```{r}

# Выполнение парного t-теста
t_test_result <- t.test(after, before, paired = TRUE, alternative = "greater")

# Наблюдаемое значение t-статистики
t_observed <- t_test_result$statistic

# Вывод наблюдаемого значения t-статистики
print(paste("Наблюдаемое значение t-статистики:", t_observed))
print(t_test_result)
```


*Оцените статистическую значимость (p-value и/или доверительный интервал)*

Наблюдаемое значение t-статистики: 2.4726, что соответствует улучшению в физической активности после реабилитации.

p-значение: p-значение составляет 0.009759, что значительно меньше уровня значимости α = 0.05. Это означает, что разница в физической активности до и после программы реабилитации статистически значима.


*Оцените практическую значимость*

Учитывая положительное значение t-статистики и низкое p-значение, можем отклонить нулевую гипотезу (H0) в пользу альтернативной гипотезы (H1). Это указывает на то, что внедрение программы реабилитации статистически значимо улучшило физическую активность пациентов с хронической болью в спине.



# Гипотеза 4. 
Применение нового метода лечения для пациентов с инфарктом миокарда увеличит долю вернувшихся к нормальной физической активности 

## Генерация данных 

```{r}

# Воспроизводимость результатов
set.seed(42)

# Общий размер выборки
sample_size <- 200

# В популяции экспериментального лечения вероятность нормальной физической активности больше (0.7 vs 0.65)
# Генерация данных по статусу лечения (бинарная переменная, 0 - стандартное лечение, 1 - новый метод) в соотношении 1:1
treatment <- sample(0:1, sample_size, replace = TRUE)

# Вероятности нормальной физической активности для различных методов лечения
prob_activity_standard <- 0.65  # для стандартного лечения
prob_activity_new <- 0.7  # для нового метода лечения

# Генерация данных по физической активности после лечения (бинарная переменная)
activity <- sapply(treatment, function(t) rbinom(1, 1, ifelse(t == 1, prob_activity_new, prob_activity_standard)))

# Создание датафрейма
task4 <- data.frame(treatment, activity)

```

## Решение

*Сформулируете нулевую и альтернативную гипотезы* 

H0: Применение нового метода лечения для пациентов с инфарктом миокарда не изменит долю пациентов вернувшихся к нормальной физической активности

H1:  Применение нового метода лечения для пациентов с инфарктом миокарда увеличит долю вернувшихся к нормальной физической активности

*Укажите уровень значимости α.*

α = 0.05 

*Определите статистический тест (критерий) для проверки гипотезы. При необходимости аргументируйте выбор одностороннего теста.* 

 Односторонний Z-тест для сравнения долей в двух независимых выборках, т.к.:
* Переменная исхода является бинарной.
* Сравнение двух независимых групп.
* Альтернативная гипотеза предполагает увеличение, а не изменение доли вернувшихся к нормальной физической активности. 

*Укажите критическое значение статистики.* 

```{r}

# Уровень значимости
alpha <- 0.05

# Критическое значение для одностороннего z-теста (правый хвост)
critical_value <- qnorm(1 - alpha)
print(paste("Критическое значение для одностороннего z-теста (правый хвост):", critical_value))

```


*Определите наблюдаемое значение статистики.*

```{r}

# Вычисление долей успеха в каждой группе
p1 <- mean(task4$activity[task4$treatment == 1])
p2 <- mean(task4$activity[task4$treatment == 0])

# Размеры выборок
n1 <- sum(task4$treatment == 1)
n2 <- sum(task4$treatment == 0)

# Общая доля успеха
p <- (sum(task4$activity[task4$treatment == 1]) + sum(task4$activity[task4$treatment == 0])) / (n1 + n2)

# Расчет z-статистики
z_observed <- (p1 - p2) / sqrt(p * (1 - p) * (1/n1 + 1/n2))

# Вывод наблюдаемого значения z-статистики
z_observed

```

*Оцените статистическую значимость (p-value и/или доверительный интервал).*
```{r}

# Расчет p-value для одностороннего теста
p_value <- pnorm(z_observed, lower.tail = FALSE)

# Расчет доверительного интервала
z_critical <- qnorm(1 - alpha)
margin_of_error <- z_critical * sqrt((p1 * (1 - p1) / n1) + (p2 * (1 - p2) / n2))
confidence_interval <- c((p1 - p2) - margin_of_error, (p1 - p2) + margin_of_error)

print(paste("p-value:", p_value))
print(paste("ДИ:", confidence_interval))

```
P-value: 0.0082, что значительно меньше установленного уровня значимости. Это означает, что есть статистически значимые различия между долями пациентов, вернувшихся к нормальной физической активности в группах нового и стандартного лечения. Можем отклонить нулевую гипотезу в пользу альтернативной.

ДИ: Доверительный интервал для разности долей лежит в пределах от 0.0474 до 0.2572. Этот интервал не включает ноль и полностью находится выше нуля, что также подтверждает статистическую значимость различий. Интервал указывает на то, что вероятное увеличение доли пациентов, вернувшихся к нормальной физической активности благодаря новому методу лечения, находится в пределах от 4.74% до 25.72%.


*Оцените практическую значимость.*

ДИ для разности долей показывает, что улучшение в доле пациентов, вернувшихся к нормальной физической активности, находится в пределах от 4.74% до 25.72%. Это означает, что новый метод лечения может увеличить долю пациентов с улучшенной физической активностью на значительную величину.


# Гипотеза 5.
Применение медитации в течение 8 недель повлияет на наличие стресса (есть/нет) у лиц с высоким уровнем тревожности.

## Генерация данных 

*не совсем поняла исходный шаблон для генерации данных. Если бинарную переменную до медитации сгенерировать в соотношении 1:1, как указано в комментарии, то не получится задать вероятность наличия стресса 0.4 vs 0.2 до и после медитаций. 
Возможно, неправильно поняла какую-то часть задания. 

```{r}
# Воспроизводимость результатов
set.seed(42)

# Размер выборки
sample_size <- 50

# Генерация данных до медитации (бинарная переменная). Вероятность наличия стресса до медитации - 0.4
prob_stress_before <- 0.4
before <- rbinom(sample_size, 1, prob_stress_before)

# Генерация данных после медитации (бинарная переменная). Вероятность наличия стресса после медитации - 0.2
prob_stress_after <- 0.2
after <- rbinom(sample_size, 1, prob_stress_after)

# Создание датафрейма
task5 <- data.frame(before, after)

```

## Решение

*Сформулируете нулевую и альтернативную гипотезы* 

H0: Применение медитации в течение 8 недель не оказывает статистически значимого влияния на наличие стресса у лиц с высоким уровнем тревожности.
H1: Применение медитации в течение 8 недель оказывает статистически значимое влияние на наличие стресса у лиц с высоким уровнем тревожности.

*Укажите уровень значимости α.*

α = 0.05

*Определите статистический тест (критерий) для проверки гипотезы. При необходимости аргументируйте выбор одностороннего теста.*

Двусторонний критерий Макнемара, т.к.:
* Бинарные данные
* Связанные выборки

Критерий Макнемара позволяет анализировать есть ли статистически значимое различие в долях наблюдений между двумя связанными выборками. Он учитывает только те случаи, где произошло изменение (то есть одна группа перешла из состояния "нет стресса" в "есть стресс" или наоборот), игнорируя случаи, где статус не изменился.

*Укажите критическое значение статистики.* 

```{r}
# Уровень значимости
alpha <- 0.05

# Критическое значение для хи-квадрат распределения с 1 степенью свободы
critical_value <- qchisq(1 - alpha, df = 1)

print(paste("Критическое значение для хи-квадрат распределения с 1 степенью свободы:", critical_value))
```

*Определите наблюдаемое значение статистики.*

```{r}
# Создание таблицы сопряженности
table_before_after <- table(task5$before, task5$after)

# Выполнение теста Макнемара
mcnemar_test_result <- mcnemar.test(table_before_after)

# Наблюдаемое значение статистики
observed_statistic <- mcnemar_test_result$statistic

# Вывод наблюдаемого значения статистики
observed_statistic

```
Критическое значение для уровня значимости 0.05 и одной степени свободы в распределении хи-квадрат составляет около 3.841, наблюдаемое значение 16.68966 значительно превышает этот порог.
Это означает, что изменения в уровне стресса до и после медитации являются статистически значимыми, и можно отклонить нулевую гипотезу (H0) в пользу альтернативной (H1).

*Оцените статистическую значимость (p-value и/или доверительный интервал).*

```{r}

# Получение p-value
p_value <- mcnemar_test_result$p.value

# Вывод p-value
print(paste("p_value:", p_value))

```
p-value намного меньше 0.05. Это указывает на то, что изменения в уровне стресса до и после медитации не случайны и статистически значимы.

*Оцените практическую значимость.*

```{r}

# Расчет доли участников с наличием стресса до медитации
prop_before <- mean(task5$before)

# Расчет доли участников с наличием стресса после медитации
prop_after <- mean(task5$after)

# Расчет величины изменения
change_in_stress <- prop_before - prop_after

# Вывод результатов
print(paste("Доля участников с наличием стресса до медитации:", prop_before))
print(paste("Доля участников с наличием стресса после медитации:", prop_after))
print(paste("Изменение в доле участников с наличием стресса:", change_in_stress))

```

Снижение доли участников с наличием стресса на 46% является значительным и представляет собой существенное улучшение.

# Гипотеза 6. 
Применение альтернативного метода лечения для пациентов с биполярным расстройством приведет к значимому изменению уровня симптомов депрессии по отношению к группе, прошедшей стандартное лечение (депрессию можно определить по шкале от 0 до 100, при этом исследователь должен избежать любых предположений (кроме i.i.d.)).

## Генерация данных 

```{r}

# Воспроизводимость результатов
set.seed(42)

# Размер выборки для каждой группы
sample_size <- 20

# Генерация данных для экспериментальной группы (альтернативное лечение, меньший средний уровень депрессии)
mean_depression_group1 <- 55
sd_depression <- 10  # Примерное стандартное отклонение
group1 <- rnorm(sample_size, mean = mean_depression_group1, sd = sd_depression)

# Генерация данных для контрольной группы (стандартное лечение, более высокий средний уровень депрессии)
mean_depression_group2 <- 68
group2 <- rnorm(sample_size, mean = mean_depression_group2, sd = sd_depression)

# Ограничение значений от 0 до 100
group1 <- pmin(pmax(group1, 0), 100)
group2 <- pmin(pmax(group2, 0), 100)

# Создание датафреймов для обеих групп
data_group1 <- data.frame(group = "Experimental", depression = group1)
data_group2 <- data.frame(group = "Control", depression = group2)

# Объединение данных в один датафрейм
task6 <- rbind(data_group1, data_group2)
```

## Решение

*Сформулируете нулевую и альтернативную гипотезы.*

H0: Применение альтернативного метода лечения для пациентов с биполярным расстройством не приводит к статистически значимому изменению уровня симптомов депрессии по сравнению с группой, прошедшей стандартное лечение.

H1: Применение альтернативного метода лечения для пациентов с биполярным расстройством приводит к статистически значимому изменению уровня симптомов депрессии по сравнению с группой, прошедшей стандартное лечение.

*Укажите уровень значимости α.*

α = 0.05 

*Определите статистический тест (критерий) для проверки гипотезы. При необходимости аргументируйте выбор одностороннего теста.*

Двусторонний t-тест для независимых выборок, т.к.:

* Две независимые группы
* Непрерывная переменная
* Данные предположительно распределены нормально

Двусторонний тест, т.к. альтернативная гипотеза предполагает возможность любого изменения.

*Укажите критическое значение статистики.*

```{r}
# Уровень значимости для двустороннего теста
alpha <- 0.05

# Число степеней свободы
df <- (sample_size * 2) - 2

# Критическое значение для двустороннего t-теста
critical_value <- qt(alpha / 2, df, lower.tail = FALSE)

# Вывод критического значения
critical_value
```

*Определите наблюдаемое значение статистики.*

```{r}
# Проведение t-теста для независимых выборок
t_test_result <- t.test(depression ~ group, data = task6)

# Получение наблюдаемого значения t-статистики
t_observed <- t_test_result$statistic

# Вывод наблюдаемого значения t-статистики
t_observed

```

Поскольку наблюдаемое значение t-статистики (2.177996) превышает критическое значение (2.024394), можно отклонить нулевую гипотезу. Это указывает на статистическую значимость различий между экспериментальной и контрольной группами.


*Оцените статистическую значимость (p-value и/или доверительный интервал).*

```{r}
p_value <- t_test_result$p.value
confidence_interval <- t_test_result$conf.int

# Вывод результатов
cat("p-value:", p_value, "\n")
cat("Доверительный интервал:", confidence_interval, "\n")
```

p-value = 0.03585888 меньше уровня значимости α = 0.05, можем отвегнуть нулевую гипотезу. Это означает, что применение альтернативного метода лечения для пациентов с биполярным расстройством действительно приводит к статистически значимому изменению уровня симптомов депрессии по сравнению с группой, прошедшей стандартное лечение.

*Оцените практическую значимость.*

Значение t-статистики превышает критическое значение, но совсем немного. Доверительный интевал достаточно широкий. Применение альтернативного метода лечения для пациентов с биполярным расстройством приводит к статистически значимому изменению уровня симптомов депрессии по сравнению с группой, прошедшей стандартное лечение, однако влияние на практическую значимость зависит от контекста и субъективной оценки. Если даже небольшие изменения в уровне депрессии имеют важное значение для пациентов и лечебного процесса, то результаты могут быть практически значимыми. Если разница между группами незначительна с практической точки зрения, то эффект может считаться непрактически значимым.


# Гипотеза 7. 
Длительность сна (в часах) ассоциирована с уровенем стресса у студентов (шкала с нормальным распределением)

## Генерация данных  

```{r, error=FALSE}

library(mvtnorm) # библиотека mvtnorm для работы с многомерным нормальным распределением

# Воспроизводимость результатов
set.seed(42)

# Размер выборки
sample_size <- 100

# Средние значения для длительности сна (HoursOfSleep) и уровня стресса (StressLevel) в популяции
means <- c(7, 5)  

# Матрица ковариации. В ислледуемой популяции HoursOfSleep и StressLevel ассоциированы отрицательно (r = -0.5)
cov_matrix <- matrix(c(1, -0.5, -0.5, 1), nrow = 2)

task7 <- rmvnorm(n = sample_size, 
              mean = means, 
              sigma = cov_matrix) %>% 
      as_tibble() %>%
      setNames(c("HoursOfSleep", "StressLevel")) 
```

## Решение 

*Сформулируете нулевую и альтернативную гипотезы.*

H0: Длительность сна не ассоциирована с уровнем стресса у студентов. Средний уровень стресса не зависит от длительности сна.

H1: Длительность сна ассоциирована с уровнем стресса у студентов. Средний уровень стресса зависит от длительности сна.

*Укажите уровень значимости α.* 

α = 0.05 

*Определите статистический тест (критерий) для проверки гипотезы. При необходимости аргументируйте выбор одностороннего теста.*

Двусторонний корреляционный тест Пирсона, т.к.: 
* Тип данных - количественные переменные.
* Линейная связь - корреляционный тест Пирсона ищет линейные связи между переменными. Если между "длительностью сна" и "уровнем стресса" существует линейная зависимость, то этот тест должен быть чувствителен к ней.
* Ассоциация без направления: В данной задаче, мы не имеем заранее предположений о том, будет ли ассоциация между "длительностью сна" и "уровнем стресса" положительной или отрицательной.

*Укажите критическое значение статистики (используйте распределения из материалов лекции).

```{r}
# Уровень значимости
alpha <- 0.05

# Размер выборки (например, 100)
n <- 100

# Вычисление критических значений для t-распределения
critical_value_left <- qt(alpha/2, df = n-2)      # Левый хвост
critical_value_right <- qt(1 - alpha/2, df = n-2) # Правый хвост

# Вывод критических значений
cat("Критическое значение статистики (левый хвост):", critical_value_left, "\n")
cat("Критическое значение статистики (правый хвост):", critical_value_right, "\n")

```


*Определите наблюдаемое значение статистики.*

```{r}
# Выполнение теста на корреляцию Пирсона
correlation_test_result <- cor.test(task7$HoursOfSleep, task7$StressLevel, method = "pearson")

# Вывод результатов
cat("Коэффициент корреляции:", correlation_test_result$estimate, "\n")
cat("p-value:", correlation_test_result$p.value, "\n")
cat("Доверительный интервал:", correlation_test_result$conf.int, "\n")

```

*Оцените статистическую значимость (p-value и/или доверительный интервал).*

Коэффициент корреляции = -0.5222265. Это указывает на умеренно сильную отрицательную корреляцию между длительностью сна и уровнем стресса. Чем дольше студенты спят, тем ниже их уровень стресса, согласно данным.

p-value = 2.510825e-08, что значительно меньше уровня значимости α = 0.05. Это означает, что вероятность получить такое или более экстремальное значение коэффициента корреляции, если бы на самом деле не было никакой корреляции (то есть если бы нулевая гипотеза была верной), очень мала. Можем отклонить нулевую гипотезу и сделать вывод о наличии статистически значимой корреляции между длительностью сна и уровнем стресса.

Доверительный интервал для коэффициента корреляции составляет от -0.6517877 до -0.363048. Этот интервал не включает 0, что подтверждает статистическую значимость корреляции. 

*Оцените практическую значимость.*

Величина коэффициента корреляции -0.5222265 указывает на умеренно сильную отрицательную связь. Это означает, что есть заметная тенденция к тому, что с увеличением длительности сна уровень стресса снижается. Однако, стоит помнить, что корреляция не означает прямую причинно-следственную связь.Результаты исследования могут подчеркивать важность сна для управления стрессом среди студентов.

*Визуализация*


```{r}

# Вычисление коэффициента корреляции и p-value
correlation <- cor(task7$HoursOfSleep, task7$StressLevel)
p_value <- cor.test(task7$HoursOfSleep, task7$StressLevel)$p.value

# Создание графика
plot <- ggplot(data = task7, aes(x = HoursOfSleep, y = StressLevel)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  
  # Добавление доверительных интервалов
  geom_ribbon(aes(ymin = predict(lm(StressLevel ~ HoursOfSleep), interval = "confidence")[, "lwr"],
                  ymax = predict(lm(StressLevel ~ HoursOfSleep), interval = "confidence")[, "upr"]),
              fill = "blue", alpha = 0.3) +
  
  # Добавление заголовка и настройка его расположения
  labs(title = "Зависимость уровня стресса от длительности сна",
       x = "Длительность сна (в часах)",
       y = "Уровень стресса") +
  
  # Добавление текста с коэффициентом корреляции и p-value
  annotate("text", x = 6, y = 8, label = paste("Коэф. корреляции =", round(correlation, 2))) +
  annotate("text", x = 6, y = 7.5, label = paste("p-value =", format(p_value, scientific = TRUE, digits = 2))) +
  
  # Настройка расположения заголовка
  theme(plot.title = element_text(hjust = 0.5))

# Вывод графика
print(plot)

```




